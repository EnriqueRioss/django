{% extends 'layouts/base2.html' %}
{% load static %}

{% block content %}
<head>
    <title>Datos del Propósito</title>
    <link rel="stylesheet" href="{% static '/styles/stylesforms.css' %}">
</head>

<div class="form-container">
    <h1>Propósito-Diagnóstico</h1>
    <p class="historia-info">Historia Clínica #{{ historia.numero_historia }}</p>
    {% if editing %}
        <p class="editing-info"><em>Modo Edición: Actualizando datos del propósito.</em></p>
    {% endif %}
    <br><br>

    <!-- 1. Give the form an ID -->
    <form method="post" enctype="multipart/form-data" id="crear-paciente-form">
        {% csrf_token %}
        <!-- 2. Add a container for non-field errors -->
        <div class="alert alert-danger non-field-errors"></div>

        <div id="proposito-diagnostico-section">
            <div class="section-liner"><h3>Datos del Propósito</h3></div><br><br>
            
            <!-- 3. Change how errors are displayed for each field -->
            <div class="form-group-medio">
                <div class="half-width">
                    <label for="{{ form.nombres.id_for_label }}">Nombres</label>
                    {{ form.nombres }}
                    <div class="field-errors" id="error_{{ form.nombres.id_for_label }}"></div>
                </div>
                <div class="half-width">
                    <label for="{{ form.apellidos.id_for_label }}">Apellidos</label>
                    {{ form.apellidos }}
                    <div class="field-errors" id="error_{{ form.apellidos.id_for_label }}"></div>
                </div>
            </div>
            <div class="form-group-medio">
                <div class="half-width">
                    <label for="{{ form.sexo.id_for_label }}">Sexo</label>
                    {{ form.sexo }}
                    <div class="field-errors" id="error_{{ form.sexo.id_for_label }}"></div>
                </div>
                <div class="half-width">
                    <label for="{{ form.fecha_nacimiento.id_for_label }}">Fecha de Nacimiento</label>
                    {{ form.fecha_nacimiento }}
                    <div class="field-errors" id="error_{{ form.fecha_nacimiento.id_for_label }}"></div>
                </div>
            </div>
            <div class="form-group-medio">
                <div class="half-width">
                    <label for="{{ form.lugar_nacimiento.id_for_label }}">Lugar de Nacimiento</label>
                    {{ form.lugar_nacimiento }}
                    <div class="field-errors" id="error_{{ form.lugar_nacimiento.id_for_label }}"></div>
                </div>
                <div class="half-width">
                    <label for="{{ form.identificacion.id_for_label }}">Identificación</label>
                    {{ form.identificacion }}
                    <div class="field-errors" id="error_{{ form.identificacion.id_for_label }}"></div>
                </div>
            </div>
             <div class="form-group-medio">
                <div class="half-width">
                    <label for="{{ form.escolaridad.id_for_label }}">Escolaridad</label>
                    {{ form.escolaridad }}
                    <div class="field-errors" id="error_{{ form.escolaridad.id_for_label }}"></div>
                </div>
                <div class="half-width">
                    <label for="{{ form.ocupacion.id_for_label }}">Ocupación</label>
                    {{ form.ocupacion }}
                    <div class="field-errors" id="error_{{ form.ocupacion.id_for_label }}"></div>
                </div>
            </div>
            <div class="form-group">
                <label for="{{ form.edad.id_for_label }}">Edad</label>
                {{ form.edad }}
                <div class="field-errors" id="error_{{ form.edad.id_for_label }}"></div>
            </div>
            <div class="form-group-medio">
                <div class="half-width">
                    <label for="{{ form.grupo_sanguineo.id_for_label }}">Grupo Sanguíneo</label>
                    {{ form.grupo_sanguineo }}
                    <div class="field-errors" id="error_{{ form.grupo_sanguineo.id_for_label }}"></div>
                </div>
                <div class="half-width">
                    <label for="{{ form.factor_rh.id_for_label }}">Factor RH</label>
                    {{ form.factor_rh }}
                    <div class="field-errors" id="error_{{ form.factor_rh.id_for_label }}"></div>
                </div>
            </div>
            <div class="form-group-medio">
                <div class="half-width">
                    <label for="{{ form.telefono.id_for_label }}">Teléfono</label>
                    {{ form.telefono }}
                    <div class="field-errors" id="error_{{ form.telefono.id_for_label }}"></div>
                </div>
                <div class="half-width">
                    <label for="{{ form.email.id_for_label }}">Email</label>
                    {{ form.email }}
                    <div class="field-errors" id="error_{{ form.email.id_for_label }}"></div>
                </div>
            </div>
            <div class="form-group">
                <label for="{{ form.direccion.id_for_label }}">Dirección</label>
                {{ form.direccion }}
                <div class="field-errors" id="error_{{ form.direccion.id_for_label }}"></div>
            </div>
            <div class="form-group">
                <label for="{{ form.foto.id_for_label }}">Foto del Proposito</label>
                {{ form.foto }}
                <div class="field-errors" id="error_{{ form.foto.id_for_label }}"></div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit">Siguiente</button>
        </div>
    </form>
</div>

<!-- 4. Add the script call at the end -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    setupAjaxForm('crear-paciente-form');
});
</script>

{% endblock %}